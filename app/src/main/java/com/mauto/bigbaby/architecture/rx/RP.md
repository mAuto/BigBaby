### 响应式编程

| 内容分组 | 描述 |
| ------ | ------ |  
| 概念和理论基础 | 概念，适用场景，优缺点 |
| 实际操作 | 结合一个demo深入探讨怎样实现一个响应式的项目架构 |
| RxJava & RxAndrod | 优缺点，值得注意的操作符，线程调度 |

#### 一 概念和理论基础
##### 1 有这样几行很简单的代码
```
/**
 * code_0
 */
int a = 1;
int b = 2;
int c = a + b; // c = 3
```
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这是一种赋值动作，而非一种变量之间的关系。也就是说此后无论a和b怎样改变value，c都不会发生改变。而响应式编程试图用某种范式来建立对象之间的这种关系，做到“响应式变化”。  

那么可以试着建立一种这样的单向的模式：

```
/**
 * code_1
 */
int a = 1;
int b = 2;
int c = Stream.just(a).just(b).op(plus);// c = 3
b = 3;// c = 4;
a = 2;// c = 5;
```

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;这像是什么开发模式？观察者模式。一个被观察事物的变化引起观察者的变化。

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;那么code_1还可以这样扩展。这里的变量不再只是一些基础变量，数量也不是两个，而是一些真真切切数量比较大结构比较复杂的数据，比如一个很长的array，一系列连续的点击事件，甚至是另一个这样的数据链等等。并且不再是简单的相加操作，将是执行一个逻辑模块，一个对这一连串数据进行某种逻辑操作方法函数，这个操作也许是过滤，整合，删除，拆包等等，经过这个逻辑之后原来的数据变成了一个新的数据，而这个新的数据可以继续接入其他的操作。最后这个数据将会和一个终点(c)建立关系，可能是需要填充的UI，也可能是等待数据反馈的观察者。

那这一连串发生的逻辑的本质又是什么？
> 这是一个对数据流层层处理并最终反馈给观察者的过程：
>
> 输入数据 --------------------- stream --------------------> 输出  
> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;逻辑_0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;逻辑_1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;逻辑_x&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;......

*** flag_0：如果观察者是UI，那这是什么架构设计模式？ ***

##### 2 响应式编程的概念
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;响应式编程是一种和以往不一样编程思路，试图突出数据流的重要性。使用响应式的项目(android)会更加清晰的被分为三部分：app = UI + 业务逻辑 + 数据流。我们可以想象一下我们平常做项目都是怎样划分的，基本上都是分散的数据流聚合的业务逻辑。但是这样或多或少都会有问题。耦合的是逻辑而不是数据，也就是说在一定程度上逻辑聚合度越高耦合性越高。

*** 什么是耦合? ***

> In computing, reactive programming is an asynchronous programming paradigm concerned with data streams and the propagation of change.

这是维基百科关于响应式编程很专业的解释。不必在乎这到底是什么意思，我们只需要注意这几个点：
- 异步编程：不同的处理线程，这是响应式的基础。
- 数据流：这个数据流分为静态数据流和动态数据流。上面提到的数组，链表甚至某个文件都属于静态数据流。动态数据流是一些时刻都在变化的数据流，比如上面说到的一次滑动事件，或者是一个正在输出的日志，都属于动态数据流。针对Stream，一个响应式的框架要提供一套统一的数据处理接口。
- 变化传递：以一个原始数据流作为输入，经过一系列逻辑(API)操作而变成了最终需要的数据，再返回给订阅者(观察者)。这像什么？函数型编程中的组合函数，事件总线中的逻辑串联，观察者模式。

** 所以到底什么是响应式编程？ **
> 响应式编程是一种可以建立响应关系的异步数据流处理框架。

*** 那么响应式编程有哪些特性? ***

##### 3 响应式编程的适用场景
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;一般来讲任何异步的场景都可以使用响应式编程。大到高并发有延迟的消息处理，频繁的服务器数据请求，网络传输，小到用户的一次点击事件的底层交互，一个数据流的过滤，组合，拆包降级等逻辑操作都可以。
##### 4 响应式编程的优缺点
- 优点

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;以RxJava/RxAndroid为例，这些框架都会复用线程，而不是无条件的创建线程消耗系统资源。并且出色的线程调度模式然开发者不用关注调用逻辑而专注于定义处理逻辑。

```
subscribeOn(Schedulers.io()).observeOn(AndroidSchedulers.mainThread())
```

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;响应式编程可以加深代码抽象程度，让开发者更专注于定义与事件相互依赖的业务逻辑以及各个业务逻辑模块之间的依赖关系，而不会过分关注实现细节，并且使用响应式编程或多或少会用到链式调用(Rx系列)，还可以使代码变得更加简洁，逻辑易懂。这样会间接的有一个好处，越清晰简单的逻辑结构越有利于单元测试。

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;另外，对于app而言，UI事件与数据的交互和反馈是用户体验的基础，对用户来说更是最直观的体现。所以想要保证一个高效且丰富多样的事件交互来达到并维持app满意的UE，就需要一个快速反应的框架来满足这一点。而响应式编程的优点正好满足这些。

- 缺点

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;因为响应式编程会用到线程复用，所以就存在几乎所有线程复用都存在的问题，一旦某个回调方法被阻塞不能继续下去，那么这个线程上的其他请求就将被阻塞而无法执行，甚至会导致应用整体被拖垮。

&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;同样因为存在链式调用的问题，调试代码将会变得比较艰难，很难定位具体问题出在哪里。就像下边一样。

```
flux.map(String::toUpperCase).doOnNext(s -> LOG.info("UC String {}", s)).next().subscribe()
```
